
<div class="autoscroll">
<table class="list permissions">
<thead>
    <tr>
    <th ondblclick="show_rows();"><%=l(:label_permissions)%></th>
    <% @roles.each do |role| %>
    <th ondblclick="hide_row(this);">
        <%= content_tag(role.builtin? ? 'em' : 'span', h(role.name)) %>
    </th>
    <% end %>
    </tr>
</thead>
<tbody>
<% perms_by_module = @permissions.group_by {|p| p.project_module.to_s} %>
<% perms_by_module.keys.sort.each do |mod| %>
    <% unless mod.blank? %>
        <tr class="group open">
          <th>
            <span class="expander" onclick="toggleRowGroup(this); return false;">&nbsp;</span>
            <%= l_or_humanize(mod, :prefix => 'project_module_') %>
          </th>
          <% @roles.each do |role| %>
          <th class="role"><%= h(role.name) %></th>
          <% end %>
        </tr>
    <% end %>
    <% perms_by_module[mod].each do |permission| %>
        <tr class="<%= cycle('odd', 'even') %> permission-<%= permission.name %>">
        <td>
            <%= l_or_humanize(permission.name, :prefix => 'permission_') %>
        </td>
        <% @roles.each do |role| %>
        <td align="center">
        <% if role.setable_permissions.include? permission %>
          <% if role.permissions.include?(permission.name) %>
              <span style="padding-left: 10px;" class="icon icon-checked"></span>
          <% else %>
	      -
          <% end %>
        <% end %>
        </td>
        <% end %>
        </tr>
    <% end %>
<% end %>
</tbody>
</table>
</div>
<%= javascript_tag do %>
  function hide_row(el) {
    index = $(el).index() + 1;
    $('thead tr th:nth-child('+index+')').hide();
    $('tbody tr th:nth-child('+index+')').hide();
    $('tbody tr td:nth-child('+index+')').hide();
  }

  function show_rows() {
    $('thead tr th').show();
    $('tbody tr th').show();
    $('tbody tr td').show();
  }
<% end %>
